# Specify services that will interact
services:

  frontend:
    image: cooopeir/conint_frontend:latest

    container_name: frontend

    restart: always

    depends_on:
      - backend

    ports:
      - "5173:5173"

  mariadb:
    build:
      context: ./mariadb
      dockerfile: Dockerfile

    environment:
      MYSQL_ROOT_PASSWORD: my-secret-pw
      MYSQL_USER: todo-admin
      MYSQL_PASSWORD: admin-pw
      MYSQL_DATABASE: tododot
    
    ports:
      - "3306:3306"
    
    restart: always

    volumes:
      - mariadb_volume:/var/lib/mysql

    networks:
      - backend_mariadb

  backend:
    image: cooopeir/conint:latest
    # SEE HOW ENVIRONMENT VARIABLES WORK IN this image

    container_name: backend
    # SEE HOW ENVIRONMENT VARIABLES WORK IN this image

    depends_on:
      - mariadb

    restart: always

    # env_file:
    #   - ./backend/env.local

    environment:
      - "DB_DIALECT=mariadb"
      - "DB_USER=todo-admin"
      - "DB_PW=admin-pw"
      - "DB_HOST=mariadb:3306"
      - "DB_NAME=tododot"

    env_file: 
      - ./backend/env.local

    ports:
      - "8080:8080"
    
    networks:
      - backend_mariadb

networks:
  backend_mariadb:

volumes:
  mariadb_volume: 